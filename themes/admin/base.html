<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>诉舍后台系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="__JS__/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__CSS__/font-awesome.min.css">
    <!--CSS引用-->
    {block name="css"}{/block}
    <link rel="stylesheet" href="__CSS__/admin.css">
    <!--[if lt IE 9]>
    <script src="__CSS__/html5shiv.min.js"></script>
    <script src="__CSS__/respond.min.js"></script>
    <![endif]-->
    <style>
        .titleImg{
            display: block;    width: 80px;    height: 80px;    margin: 0 19px 0;-webkit-border-radius: 50%;
        }
        .toptitle{ color: #ccc;    font-size: 22px;    float: left;    margin-left: 10px;    margin-top: 15px;}
    </style>
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <!--头部-->
    <div class="layui-header header">
        <a href="" class="toptitle">诉舍后台管理系统</a>
        <div id="msg">11</div>
        <input id="text" value="">
        <input type="submit" value="send" onclick="start()">
        <input type="submit" value="close" onclick="close()">
        <a class="layui-nav-item toptitle" title="点击收缩菜单栏" id="slidedes" attr-type=1 style="margin-left: 26px;margin-top: 15px;cursor: pointer;">
            <img style="width: 35px;" src="/static/images/yingyong.png">
        </a>
        <ul class="layui-nav" style="position: absolute;top: 0;right: 20px;background: none;">

            <li class="layui-nav-item"><a style="cursor: pointer;" title="点击设置价格" onclick="setPrice();">当前律师函价格：<span style="color: red;">{$money}</span>&nbsp;元</a></li>
            <li class="layui-nav-item"><a href="" data-url="{:url('jdroom/system/clear')}" id="clear-cache"></a></li>
            <li class="layui-nav-item"><a href="/jdroom/Orderlist/index">待接单数：<span class="layui-badge">{$counts}</span></a></li>
            <li class="layui-nav-item"><a></a></li>
            <li class="layui-nav-item lockcms" pc>
                <a href="javascript:;"><i class="layui-icon seraph icon-lock" >&#xe638;</i>  <cite>锁屏</cite></a>
            </li>
            <li class="layui-nav-item">
                <a href="javascript:;">{:session('admin_name')}</a>
                <dl class="layui-nav-child"> <!-- 二级菜单 -->
                    <dd><a href="{:url('jdroom/change_password/index')}">修改密码</a></dd>
                    <!--<dd><a href="{:url('jdroom/login/logout')}">退出登录</a></dd>-->
                    <dd><a style="cursor: pointer;" onclick="logout();">退出登录</a></dd>
                </dl>
            </li>
        </ul>
    </div>

    <!--侧边栏-->
    <div class="layui-side layui-bg-black">
        <div style="height: 150px;">
            <a style="margin-left: 20px;margin-top: 10px;margin-bottom: 10px;">
                <a><img class="titleImg"  src="/static/admin/images/timg.jpg"></a><br>
                <span style="margin-left: 10px;" id="showMe">你好！{:session('admin_name')}， 欢迎登录</span>
            </a>
        </div>
        <div class="layui-side-scroll" style="height: 500px;">
            <ul class="layui-nav layui-nav-tree">
                <!--<li class="layui-nav-item layui-nav-title"><a>管理菜单</a></li>-->
                <li class="layui-nav-item">
                    <a href="{:url('jdroom/index/index')}"><i class="fa fa-home"></i> 网站信息</a>
                </li>
                {foreach name="menu" item="vo"}
                    {if condition="isset($vo['children'])"}
                        <li class="layui-nav-item ">
                            <a href="javascript:;"><i class="{$vo.icon}"></i> {$vo.title}</a>
                            <dl class="layui-nav-child">
                                {foreach name="vo['children']" item="v"}
                                    <dd><a href="{:url($v.name)}">{$v.title}</a></dd>
                                {/foreach}
                            </dl>
                        </li>
                    {else /}
                        <li class="layui-nav-item ">
                            <a href="{:url($vo.name)}"><i class="{$vo.icon}"></i> {$vo.title}</a>
                        </li>
                    {/if}
                {/foreach}

                <li class="layui-nav-item" style="height: 30px; text-align: center"></li>
            </ul>
        </div>
    </div>

    <!--主体-->
    {block name="body"}
    {/block}

    <!--底部-->
    <div class="layui-footer footer">
        <div class="layui-main">
            <p>2016-2017 &copy; 诉舍后台系统</p>
        </div>
    </div>
</div>
<script>
    // 定义全局JS变量
    var GV = {
        current_controller: "jdroom/{$controller|default=''}/",
        base_url: "__STATIC__"
    };
</script>
<!--JS引用-->
<script src="__JS__/jquery.min.js"></script>
<!--<script src="__JS__/layui/lay/dest/layui.all.js"></script>-->
<script src="__JS__/layui/layui.all.js"></script>
<script src="__JS__/admin.js"></script>
<script src='http://cdn.bootcss.com/socket.io/1.3.7/socket.io.js'></script>
{block name="js"}{/block}
<!--页面JS脚本-->
{block name="script"}
<script>
    /**
     0：未连接

     1：连接成功，可通讯

     2：正在关闭

     3：连接已关闭或无法打开
     */

    //创建一个webSocket 实例
    var webSocket  = new  WebSocket("ws://39.105.69.72:80");


    webSocket.onerror = function (event){
        onError(event);
    };

    // 打开websocket
    webSocket.onopen = function (event){
        onOpen(event);
    };

    //监听消息
    webSocket.onmessage = function (event){
        onMessage(event);
    };


    webSocket.onclose = function (event){
        onClose(event);
    }

    //关闭监听websocket
    function onError(event){
        document.getElementById("msg").innerHTML = "<p>close</p>";
        console.log("error"+event.data);
    };

    function onOpen(event){
        console.log("open:"+sockState());
        document.getElementById("msg").innerHTML = "<p>Connect to Service</p>";
    };
    function onMessage(event){
        console.log("onMessage");
        document.getElementById("msg").innerHTML += "<p>response:"+event.data+"</p>"
    };

    function onClose(event){
        document.getElementById("msg").innerHTML = "<p>close</p>";
        console.log("close:"+sockState());
        webSocket.close();
    }

    function sockState(){
        var status = ['未连接','连接成功，可通讯','正在关闭','连接已关闭或无法打开'];
        return status[webSocket.readyState];
    }



    function start(event){
        console.log(webSocket);
        var msg = document.getElementById('text').value;
        document.getElementById('text').value = '';
        console.log("send:"+sockState());
        console.log("msg="+msg);
        webSocket.send("msg="+msg);
        document.getElementById("msg").innerHTML += "<p>request"+msg+"</p>"
    };

    function close(event){
        webSocket.close();
    }
</script>
{/block}
</body>
</html>